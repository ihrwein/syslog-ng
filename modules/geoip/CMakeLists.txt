set(GEOIP_SOURCES
    geoip-parser.c
    geoip-parser.h
    geoip-parser-parser.c
    geoip-parser-parser.h
    geoip-plugin.c
    ${CMAKE_CURRENT_BINARY_DIR}/geoip-parser-grammar.c
    ${CMAKE_CURRENT_BINARY_DIR}/geoip-parser-grammar.h
)

generate_y_from_ym(modules/geoip/geoip-parser-grammar)

find_package(LibGeoIP)

option(ENABLE_GEOIP "Enable GeoIP parser" ON)

if(LIBGEOIP_FOUND AND ENABLE_GEOIP)
    set(BUILD_GEOIP ON)
else()
    set(BUILD_GEOIP OFF)
endif()

if (BUILD_GEOIP)
    bison_target(GeoIPGrammar
        ${CMAKE_CURRENT_BINARY_DIR}/geoip-parser-grammar.y
        ${CMAKE_CURRENT_BINARY_DIR}/geoip-parser-grammar.c
        COMPILE_FLAGS ${BISON_FLAGS})

    add_library(geoip MODULE ${GEOIP_SOURCES})
    target_link_libraries (geoip PUBLIC ${LibGeoIP_LIBRARY})
    target_include_directories (geoip SYSTEM PRIVATE ${LibGeoIP_INCLUDE_DIR})
    target_include_directories (geoip PRIVATE ${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_CURRENT_SOURCE_DIR})
    target_link_libraries(geoip PRIVATE syslog-ng)
endif()
